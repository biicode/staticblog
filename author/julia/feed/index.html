<?xml version="1.0" encoding="UTF-8"?><rss
version="2.0"
xmlns:content="http://purl.org/rss/1.0/modules/content/"
xmlns:wfw="http://wellformedweb.org/CommentAPI/"
xmlns:dc="http://purl.org/dc/elements/1.1/"
xmlns:atom="http://www.w3.org/2005/Atom"
xmlns:sy="http://purl.org/rss/1.0/modules/syndication/"
xmlns:slash="http://purl.org/rss/1.0/modules/slash/"
> <channel><title>biicode Blog &#187; julia</title> <atom:link href="http://blog.biicode.com/author/julia/feed/" rel="self" type="application/rss+xml" /><link>http://blog.biicode.com</link> <description>Almost daily C and C++ jibby jabba</description> <lastBuildDate>Sun, 16 Aug 2015 07:58:20 +0000</lastBuildDate> <language>en-US</language> <sy:updatePeriod>hourly</sy:updatePeriod> <sy:updateFrequency>1</sy:updateFrequency> <generator>http://wordpress.org/?v=4.2.5</generator> <item><title>Using your custom CMake toolchain</title><link>http://blog.biicode.com/custom-cmake-toolchain/</link> <comments>http://blog.biicode.com/custom-cmake-toolchain/#comments</comments> <pubDate>Mon, 20 Oct 2014 10:42:38 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[try this out]]></category> <category><![CDATA[cmake]]></category> <category><![CDATA[CMake toolchains]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=1815</guid> <description><![CDATA[<p>OUTDATED: Check the new way to customize your toolchain with biicode in this post: Raspberry PI cross building native (C/C++) Step by step we are making biicode easier to customize, our latest addition is to allow users using a custom CMake toolchain instead of the autogenerated one. The problem with CMake toolchains The main problem [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/custom-cmake-toolchain/">Using your custom CMake toolchain</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p><strong>OUTDATED:</strong> Check the new way to customize your toolchain with biicode in this post:<a
title="Raspberry Pi toolchain updated" href="http://blog.biicode.com/raspberry-pi-cross-building-opengl-glfw-windows"> Raspberry PI cross building native (C/C++)</a></p><p>Step by step we are making biicode easier to customize, our latest addition is to allow users using a custom CMake toolchain instead of the autogenerated one.<img
class="aligncenter wp-image-1819 size-full" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/10/cmakebanner.jpg" alt="CMake toolchain is easier to customize now with biiicode" width="532" height="147" /> <span
id="more-1815"></span></p><h2>The problem with CMake toolchains</h2><p>The main problem achieving this is that toolchains have absolute routes to compilers so they are difficult to share as part of a biicode block so, in addition to providing toolchain customization we also provide a token replacement system which you can configure in your <a
href="http://docs.biicode.com/c++/reference/configuration_files/settings.html">project settings.</a></p><h2>Example of how to customize CMake toolchains</h2><p
class="">Take the block <a
href="http://www.biicode.com/fenix/armadillo">fenix/armadillo</a>. It requires gcc &gt;= 4.7.2 to compile, but the default rpi compiler is 4.7.1, so we’d like to define our toolchain and share it so other people can use it. Biicode installs different rpi compilers in BII_ENV folder, so you can choose a different one for this task. You can create a toolchain file in your block like this:</p><p></p><pre class="crayon-plain-tag">INCLUDE(CMakeForceCompiler)
SET(CMAKE_SYSTEM_NAME Linux)
SET(CMAKE_SYSTEM_VERSION 1)
SET(CMAKE_C_COMPILER BII_ENV/raspberry_cross_compilers/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf-gcc)
SET(CMAKE_CXX_COMPILER BII_ENV/raspberry_cross_compilers/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian/bin/arm-linux-gnueabihf-g++)</pre><p>Now if you want to use this toolchain you can modify your project settings to include the bold line:</p><pre class="crayon-plain-tag">cpp: {cross_build: ARM, generator: Unix Makefiles,
      toolchain: {"path":fenix/armadillo/rpi_toolchain.cmake}}
os: {arch: 64bit, family: Linux, subfamily: Ubuntu, version: '13.10'}
rpi: {directory: armadillo, ip: 192.168.1.101, user: pi}</pre><p>If you want to share your toolchain with people reusing your block you will also need to add it to your bii/dependencies.bii (inside your block):</p><pre class="crayon-plain-tag">+ rpi_toolchain.cmake</pre><p>And that’s all, this will work for anyone that has installed cross compilers by running</p><p><code>bii setup:rpi</code>. BII_ENV will expand to default bii tools installation directory. But you can provide even more flexibility to your block’s users and allow them to use any compiler they want by defining replacement tokens, for example:</p><pre class="crayon-plain-tag">INCLUDE(CMakeForceCompiler)
SET(CMAKE_SYSTEM_NAME Linux)
SET(CMAKE_SYSTEM_VERSION 1)
SET(CMAKE_C_COMPILER COMPILER_PATH/bin/COMPILER_NAME-gcc)
SET(CMAKE_CXX_COMPILER COMPILER_PATH/bin/COMPILER_NAME-g++)</pre><p>Then you can set your <a
href="http://docs.biicode.com/c++/reference/configuration_files/settings.html">settings</a> as follows:</p><pre class="crayon-plain-tag">cpp: {cross_build: ARM, generator: Unix Makefiles,
      toolchain: {"path": fenix/armadillo/rpi_toolchain.cmake,
                  "replacements": {COMPILER_PATH: /home/julia/raspberry_cross_compilers/arm-bcm2708/gcc-linaro-arm-linux-gnueabihf-raspbian
               COMPILER_NAME: gcc-linaro-arm-linux}}}
os: {arch: 64bit, family: Linux, subfamily: Ubuntu, version: '13.10'}
rpi: {directory: armadillo, ip: 192.168.1.101, user: pi}</pre><p></p><h3>Conclusions</h3><p>Some times our users make us realize we are not providing them all the flexibility they need. Adding this feature was quite easy in fact, but without your feedback we would not have thought of it.</p><p>So please keep contributing with your ideas, unresolved problems and opinions. I hope you liked the example and if you have any doubts or questions please feel free to comment the post, share it in our <a
href="http://forum.biicode.com">Forum</a> or check our <a
href="http://docs.biicode.com">Documentation</a>.</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/custom-cmake-toolchain/">Using your custom CMake toolchain</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/custom-cmake-toolchain/feed/</wfw:commentRss> <slash:comments>1</slash:comments> </item> <item><title>How to integrate biicode with git using git hooks</title><link>http://blog.biicode.com/git-hooks/</link> <comments>http://blog.biicode.com/git-hooks/#comments</comments> <pubDate>Wed, 20 Aug 2014 08:59:00 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[biicode]]></category> <category><![CDATA[try this out]]></category> <category><![CDATA[git]]></category> <category><![CDATA[git hooks]]></category> <category><![CDATA[github integration]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=1130</guid> <description><![CDATA[<p>Our users have asked a lot for github integration. This can be easily achieved with git hooks. Git hooks are scripts which are executed when certain actions happen and they can run in the client or the server. Using git hooks For example I want to put my state machine library on github, and I [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/git-hooks/">How to integrate biicode with git using git hooks</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p>Our users have asked a lot for github integration. This can be easily achieved with git hooks. Git hooks are scripts which are executed when certain actions happen and they can run in the client or the server.</p><div
id="attachment_1148" style="width: 610px" class="wp-caption aligncenter"><img
class="wp-image-1148" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/08/git-hooks.jpg" alt="Integrate biicode using git hooks" width="600" height="128" /><p
class="wp-caption-text">Credit: http://www.gianlucaguarini.com/</p></div><p><span
id="more-1130"></span></p><h2>Using git hooks</h2><p>For example I want to put my state machine library on github, and I want to publish a new DEV version in biicode each time a push to master. My <a
title="State machine block" href="http://www.biicode.com/hithwen/statemachine">state machine library is already on biicode</a>, but not in github, so first I create a <a
href="https://github.com/hithwen/statemachine">new github repository</a> and then I go to my block folder and initialize a git repo inside:</p><pre class="crayon-plain-tag">$ cd /Users/hithwen/Desktop/state_machine/blocks/hithwen/statemachine
$ git init
$ git remote add origin https://github.com/hithwen/statemachine.git</pre><p>Now I can create the hook. In this case we will use the pre-push hook. Pre-action hooks run before the action actually happens. If the hook fails then the action is not performed. Ideally we would prefer to use a post-push hook but git does not support them.</p><pre class="crayon-plain-tag">$ vim .git/hooks/pre-push  # You need git &gt; 1.8.2</pre><p></p><pre class="crayon-plain-tag">#!/bin/sh
remote="$1"
url="$2"
while read local_ref local_sha remote_ref remote_sha
do
	if [[ $remote_ref == "refs/heads/master" ]]; then
		bii publish --tag DEV --msg "Git autopublish ${local_sha}"
	fi
done
exit 0</pre><p>From now on each time time you push to your master branch in github your biicode DEV version will be updated. If you want to freeze a stable version you need to do:</p><pre class="crayon-plain-tag">$ bii publish --tag STABLE</pre><p></p><pre class="crayon-plain-tag">$ chmod a+x .git/hooks/pre-push
$ git push --set-upstream origin master
$ git push origin master
INFO: Processing changes...
*****************************
***** Publishing public ****
*****************************
INFO: Please log in to perform this action. If you don't have an account sign up here: http://www.biicode.com
Please enter a password for "hithwen" account:
INFO: Publishing block: hithwen/statemachine
INFO: Successfully published hithwen/statemachine: 12
Counting objects: 5, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (3/3), done.
Writing objects: 100% (3/3), 288 bytes | 0 bytes/s, done.
Total 3 (delta 2), reused 0 (delta 0)
To https://github.com/hithwen/statemachine.git
   f001366..2160752  master -&gt; master</pre><p>et voila!</p><p></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/git-hooks/">How to integrate biicode with git using git hooks</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/git-hooks/feed/</wfw:commentRss> <slash:comments>1</slash:comments> </item> <item><title>bii internals: C vs Python efficiency</title><link>http://blog.biicode.com/bii-internals-c-vs-python/</link> <comments>http://blog.biicode.com/bii-internals-c-vs-python/#comments</comments> <pubDate>Sat, 12 Jul 2014 08:00:57 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[biicode]]></category> <category><![CDATA[bii-internals]]></category> <category><![CDATA[cython]]></category> <category><![CDATA[efficency]]></category> <category><![CDATA[obfuscate]]></category> <category><![CDATA[python]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=846</guid> <description><![CDATA[<p>In our bii internal series we’ve walked through the process to convert our python code into C code, compile it as a python native extension to distribute it for different platforms. One of the major drawbacks of using native code is that we are not supporting all systems but, on the other side, we gain in [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-c-vs-python/">bii internals: C vs Python efficiency</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p>In our bii internal series we’ve walked through the process to convert our <a
title="compiling your python app with cython" href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/" target="_blank">python code into C code</a>, compile it as a python native extension to <a
title="automating pkg genration biicode" href="http://blog.biicode.com/bii-internals-automating-deb-pkg-generation/" target="_blank">distribute it for different platforms</a>. One of the major drawbacks of using native code is that we are not supporting all systems but, on the other side, we gain in efficiency and have more control over the environments where the app runs. We’re doing some benchmark to see how much faster is biicode processing projects: running all in python code or with the native extensions.</p><p><span
id="more-846"></span></p><p>First of all, let’s explain a bit what biicode does on every operation. At first it makes a <b>check in</b> to read files from the hard disk and it checks if they’ve changed and caches them. Then, if any files have changed, it <b>processes</b> your project which means that it parses source code, searching for dependencies, analyzes your dependencies, configuration etc. The final step is <b>checking out</b> to disk file changes and external dependencies that were already in local cache.</p><p>We’ve tested how biicode processes different libraries: running python code vs cythonized code. We’ve measured following times:</p><ul><li>Check-In: Time to read all files and cache them in memory.</li><li>Process: Time to parse code, and analyze dependencies.</li><li>Reprocess: Time to reprocess files without changes.</li></ul><p>These are the results (in seconds) for SDL library, which contains 2130 files:</p><table><tbody><tr><td></td><td><strong>Python</strong></td><td><strong>Native extensions</strong></td></tr><tr><td><strong>Check-In</strong></td><td>0.26206111908 s</td><td>0.262398004532 s</td></tr><tr><td><strong>Process</strong></td><td>9.54270887375 s</td><td>6.47844004631 s</td></tr><tr><td><strong>Reprocess</strong></td><td>1.45510792732 s</td><td>1.36480784416 s</td></tr></tbody></table><p>As you can see that check-in time is the same in both cases as it involves reading tons of files from disk so it&#8217;s IO bounded not processor bounded.</p><p>Also reprocess time is very similar, with a slightly improvement in native extensions. Reprocess makes sure there’s no need to calculate anything new.</p><p>Where you can notice major improvements is in processing time where native extensions take the 68% of the time of plain python code, 3 seconds of extra time mean a lot in terms of user experience.</p><p>Performance gain is not constant  for every library, but it increases along with number of files/relations being processed. For projects smaller than 500 files performance gain is between 7% and 8%, for larger projects it boosts up to 32%  as observed in SDL case.</p><div
id="attachment_847" style="width: 610px" class="wp-caption alignnone"><img
class="wp-image-847 size-full" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/07/image.png" alt="Same code running on python or python native extension" width="600" height="371" /><p
class="wp-caption-text">Same code running on python or python native extension</p></div><p>So, is it worth compiling to C code? Well, depends on your project, of course. If your program is IO bounded then probably it isn&#8217;t worthy, but if you need to do tons of processing then you might consider it,  setting up the <a
title="compiling your python app with cython" href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/" target="_blank">compile</a>&#8211;<a
title="packaging a compiled app with pi installer" href="http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/" target="_blank">package</a> process is very easy.</p><p>You can check all the posts in the series, and in case of doubts, I’ll be happy to help you, <a
title="google plus Julia" href="https://plus.google.com/+JuliaSSimon" target="_blank">contact me</a>.<br
/></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-c-vs-python/">bii internals: C vs Python efficiency</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/bii-internals-c-vs-python/feed/</wfw:commentRss> <slash:comments>0</slash:comments> </item> <item><title>bii internals: Automating DEB pkg generation</title><link>http://blog.biicode.com/bii-internals-automating-deb-pkg-generation/</link> <comments>http://blog.biicode.com/bii-internals-automating-deb-pkg-generation/#comments</comments> <pubDate>Mon, 23 Jun 2014 08:00:20 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[biicode]]></category> <category><![CDATA[automate]]></category> <category><![CDATA[bii-internals]]></category> <category><![CDATA[deb]]></category> <category><![CDATA[generation]]></category> <category><![CDATA[pkg]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=677</guid> <description><![CDATA[<p>To continue with our series about packaging and distributing biicode, today we are talking about deb packages generation. Even though deb packages are broadly documented, sometimes a concrete example is more helpful. To create a debian package we need to create a folder called DEBIAN. In that folder we will place our program files, recreating [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-automating-deb-pkg-generation/">bii internals: Automating DEB pkg generation</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p>To continue with our series about packaging and distributing biicode, today we are talking about deb packages generation. Even though deb packages are broadly documented, sometimes a concrete example is more helpful.</p><p><span
id="more-677"></span></p><p>To create a debian package we need to create a folder called DEBIAN. In that folder we will place our program files, recreating the structure we want in the client&#8217;s machines. This means that if we want biicode installed inside /usr/lib/biicode then we place biicode inside DEBIAN/usr/lib/biicode. Following the same schema, copyright file should be placed in DEBIAN/usr/share/doc/biicode/copyright. Along with these contents we should also place the control file and the scripts needed to finish installation or removal process. In this case we need postinst and prerm, that will run with sudo permissions.</p><p>To sum up this is how our DEBIAN directory should look like:</p><pre class="crayon-plain-tag">├── DEBIAN
│   ├── control
│   ├── postinst
│   ├── prerm
│   └── usr
│       └── share
│       |   └── doc
│       |       └── biicode
│       |           └── copyright
│       └── lib
│           └── biicode
│               └── # Tons os stuff</pre><p>You can read <a
title="Debian Control File Documentation" href="http://www.debian.org/doc/debian-policy/ch-controlfields.html" target="_blank">control file documentation</a> at debian&#8217;s page, our control file looks like this:</p><pre class="crayon-plain-tag">Package: biicode
Priority: optional
Section: devel
Maintainer: Julia S.Simon &lt;julia.simon@biicode.com&gt;
Architecture: %ARCHITECTURE%
Version: %VERSION%
Depends: zlib1g, libc-bin
Recommends: build-essential | python2.7 | nodejs
Homepage: http://www.biicode.com
Installed-Size: %SIZE%
Description: Biicode
 Biicode is a novel tool that aims to make easier our lives as developers.
 It will make you forget about setting up dependencies, build scripts,
 distribution... and let us focus on the only task that is valuable,
 productive, creative and cannot be automated, which is coding.</pre><p>In the postinstallation step we just create a symlink in the PATH:</p><pre class="crayon-plain-tag">#!/usr/bin/env/ bash
chmod -R a+rx /usr/lib/biicode/
ln -s -f /usr/lib/biicode/bii /usr/bin/bii</pre><p>Which is removed in the pre-remove step:</p><pre class="crayon-plain-tag">#!/usr/bin/env bash
rm /usr/bin/bii</pre><p>We also have a small bash script to set the permissions, calculate md5sum and creates the package.<br
/> Md5sum contains a list of MD5 checksums for all files contained within the package so they can be verified when they are extracted to the client&#8217;s machine:</p><pre class="crayon-plain-tag">chmod 755 ${POSTINST_FILE}
chmod 755 ${PRERM_FILE}
chmod 755 ${TMPDIR}/DEBIAN
chmod 755 ${TMPDIR}/DEBIAN/control
find ${TMPDIR}/usr -type d -exec chmod 755 {} +
echo "cd ${TMPDIR}"
cd ${TMPDIR}
echo "Calculating md5sums"
find . -type f ! -regex '.*?biicode*' ! -regex '.*?DEBIAN.*' -printf '%P ' | xargs md5sum &gt; DEBIAN/md5sums
chmod 644 DEBIAN/md5sums
echo "cd ${HOLDER}"
cd ${HOLDER}
fakeroot dpkg-deb -z8 -Zgzip --build biicode
echo "cp biicode.deb ~/biicode.deb"</pre><p>Finally everything is wired up with a python script that grabs <a
title="bii internals: Compiling your python application with Cython" href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/" target="_blank">cythonized</a>,<a
title="bii internals: Packaging a compiled app with PyInstaller" href="http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/" target="_blank"> pyinstalled</a> biicode, creates the folder structure and invokes mentioned bash script:</p><pre class="crayon-plain-tag">import shutil
import os
import tempfile
from biicode.common import __version__
from biicode.common.utils import file_utils
from biicode.utils.pack import create_client_binary
from biicode.client.command.process_executor import execute
import sys
import platform
def get_folder_size(p):
    size = os.popen('du -s %s' % p).read()
    return int(size.split('\t')[0])
def main(compiled=True, force_compile=False):
    create_client_binary.main(compiled=compiled, onefile=False, force_compile=force_compile)
    folder_temp = tempfile.mkdtemp(suffix='biicode')
    tmpdir = os.path.join(folder_temp, 'biicode')
    os.mkdir(tmpdir)
    pkg_path = os.path.join(tmpdir, 'usr/lib/biicode')
    debian_path = os.path.join(tmpdir, 'DEBIAN')
    os.mkdir(debian_path)
    share_path = os.path.join(tmpdir, 'usr/share')
    compiled_path = os.path.expanduser('~/PyInstaller-2.1/bii/dist/bii')
    src_debian_path = os.path.join(os.path.dirname(__file__), 'resources/DEBIAN')
    src_share_path = os.path.join(os.path.dirname(__file__), 'resources/DEBIAN/usr/share')
    to_deb_script = os.path.join(os.path.dirname(__file__), 'resources/DEBIAN/to_deb.sh')
    control_file = os.path.join(debian_path, 'control')
    postinst_file = os.path.join(debian_path, 'postinst')
    prerm_file = os.path.join(debian_path, 'prerm')
    print 'Copying compiled folder %s to %s' % (compiled_path, pkg_path)
    shutil.copytree(compiled_path, pkg_path)
    shutil.copy(os.path.join(src_debian_path, 'control'), control_file)
    shutil.copy(os.path.join(src_debian_path, 'postinst'), postinst_file)
    shutil.copy(os.path.join(src_debian_path, 'prerm'), prerm_file)
    shutil.copytree(src_share_path, share_path)
    arch = platform.architecture()[0]
    if arch == '64bit':
        architecture = 'amd64'
    else:
        if 'arm' in platform.machine():
            architecture = 'armhf'
        else:
            architecture = 'i386'
    version = __version__
    if version == 'develop':
        version = '0'
    file_utils.search_and_replace(control_file, '%VERSION%', version)
    file_utils.search_and_replace(control_file, '%ARCHITECTURE%', architecture)
    file_utils.search_and_replace(control_file, '%SIZE%', str(get_folder_size(compiled_path)))
    from os.path import expanduser
    home = expanduser("~")
    env = {'POSTINST_FILE': postinst_file,
           'PRERM_FILE': prerm_file,
           'TMPDIR': tmpdir,
           'HOLDER': folder_temp,
           'HOME': home}
    retcode, _ = execute(to_deb_script, env=env)
    sys.exit(retcode)
if __name__ == '__main__':
    main()</pre><p>Have you tried to package your own installer now? We hope you have!</p><p>Did you miss how to package an app for other OS?</p><ul><li>They are available here: for <a
title="windows installer" href="http://blog.biicode.com/bii-internals-how-to-do-your-own-windows-installer/" target="_blank">Windows </a> and for <a
title="MacOS Installer" href="http://blog.biicode.com/bii-internals-automating-macos-pkg-generation/" target="_blank">MacOS</a>.</li></ul><p>Happy hacking!<br
/></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-automating-deb-pkg-generation/">bii internals: Automating DEB pkg generation</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/bii-internals-automating-deb-pkg-generation/feed/</wfw:commentRss> <slash:comments>1</slash:comments> </item> <item><title>bii internals: Automating MacOS pkg generation</title><link>http://blog.biicode.com/bii-internals-automating-macos-pkg-generation/</link> <comments>http://blog.biicode.com/bii-internals-automating-macos-pkg-generation/#comments</comments> <pubDate>Fri, 06 Jun 2014 08:52:36 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[biicode]]></category> <category><![CDATA[bii-internals]]></category> <category><![CDATA[mac]]></category> <category><![CDATA[macos]]></category> <category><![CDATA[pkg]]></category> <category><![CDATA[pkgbuild]]></category> <category><![CDATA[productbuild]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=618</guid> <description><![CDATA[<p>In a previous posts we talked about how we cythonized and packaged biicode with pyinstaller. Now we will explain how to generate installers for the different systems, starting with mac. The problem with pkg generation is that most of the existing tutorials and references are xcode oriented, and we just wanted to use plain console. [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-automating-macos-pkg-generation/">bii internals: Automating MacOS pkg generation</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p>In a previous posts we talked about how we <a
title="bii internals: Compiling your python application with Cython" href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/">cythonized</a> and <a
title="bii internals: Packaging a compiled app with PyInstaller" href="http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/">packaged biicode with pyinstaller</a>. Now we will explain how to generate installers for the different systems, starting with mac. The problem with pkg generation is that most of the existing tutorials and references are xcode oriented, and we just wanted to use plain console.</p><p><span
id="more-618"></span></p><p>Let’s get started on how generate a mac installer:</p><p>Before packaging we need to prepare a set of additional files: license and welcome text, background img, postinstall script and the Distribution.xml.</p><p><strong>Distribution.xm</strong>l is a distribution definition file which defines the installation experience for the installer package that contains it, you can read about its different options in the <a
href="https://developer.apple.com/library/mac/documentation/DeveloperTools/Reference/DistributionDefinitionRef/Chapters/Introduction.html#//apple_ref/doc/uid/TP40005370-CH1-SW1">Apple developers page</a>. A minimal Distribution.xml looks like this:</p><pre class="crayon-plain-tag">&lt;?xml version="1.0" encoding="utf-8" standalone="yes"?&gt;
   &lt;installer-gui-script minSpecVersion="2"&gt;
   &lt;!--+==========================+
       |       Presentation       |
       +==========================+--&gt;
   &lt;title&gt;Biicode&lt;/title&gt;
   &lt;options customize="never" rootVolumeOnly="true"/&gt;
   &lt;welcome file="Welcome.rtf"/&gt;
   &lt;license file="license.rtf"/&gt;
   &lt;background file="background.png" scaling="proportional" alignment="bottomleft"/&gt;
   &lt;allowed-os-versions&gt;
       &lt;os-version min="10.9" /&gt;
   &lt;/allowed-os-versions&gt;
   &lt;options customize="never" require-scripts="false"/&gt;
   &lt;product id="biicode" version="%VERSION%" /&gt;
   &lt;!--+==========================+
       |         Installer        |
       +==========================+--&gt;
   &lt;choices-outline&gt;
       &lt;line choice="default"&gt;
           &lt;line choice="biicode"/&gt;
       &lt;/line&gt;
   &lt;/choices-outline&gt;
   &lt;choice id="default"/&gt;
   &lt;choice id="biicode" visible="false"&gt;
       &lt;pkg-ref id="biicode"/&gt;
   &lt;/choice&gt;
   &lt;!--+==========================+
       |    Package References    |
       +==========================+--&gt;
   &lt;pkg-ref id="biicode" version="%VERSION%" onConclusion="none"&gt;%PKG%&lt;/pkg-ref&gt;
&lt;/installer-gui-script&gt;</pre><p><strong>postinstall</strong> script is a script that runs as super user after installation is complete. In our case it will set permissions and create a symbolic link in the PATH:</p><pre class="crayon-plain-tag">#!/usr/bin/env bash
echo "Setting permissions"
sudo chmod -R a+rx /usr/lib/biicode
echo "Creating symlink"
sudo ln -f -s /usr/lib/biicode/bii /usr/bin/bii</pre><p><strong>Welcome.rtf</strong> is the rich text that appears in the first step of the installation wizard, that looks like this:</p><div
id="attachment_619" style="width: 640px" class="wp-caption aligncenter"><img
class="wp-image-619" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/06/wizard1.png" alt="Biicode installation Wizard: Welcome" width="630" height="447" /><p
class="wp-caption-text">Biicode installation Wizard: Welcome</p></div><p><strong>background.png</strong> is the image containing the bee you se above.</p><p><strong>license.rtf</strong> contains the license users need to accept in the next step.</p><div
id="attachment_620" style="width: 640px" class="wp-caption aligncenter"><img
class="wp-image-620 size-full" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/06/wizard2.png" alt="Biicode installation Wizard: License" width="630" height="440" /><p
class="wp-caption-text">Biicode installation Wizard: License</p></div><p>Both Welcome and license can be in different languages with the proper suffixes so they will display in the user’s language.</p><p>In our automation repo we have all these files in a folder like this:</p><pre class="crayon-plain-tag">resources
├── macos
   ├── Distribution.xml
   ├── Resources
   │   ├── Welcome.rtf
   │   ├── background.png
   │   └── license.rtf
   └── scripts
       └── postinstall</pre><p>Now that we have everything set up we can start packaging, the main script looks like this:</p><pre class="crayon-plain-tag">import os
import sys
import tempfile
folder_tmp = tempfile.mkdtemp(suffix='biicode')
   pkg_path = os.path.join(folder_tmp, 'tmpbiicode.pkg')
   resources = os.path.join(os.path.dirname(__file__), 'resources/macos/')
   retcode = create_package_from_sources(binary_path, pkg_path, resources)
   if retcode == 0:
       retcode = create_product_package(folder_tmp, resources)
   sys.exit(retcode)</pre><p>This script, creates a temporary directory to work in, creates the base package, patches the distribution file and creates the final pkg to release. binary_path is the path to the app processed by PyInstaller.</p><pre class="crayon-plain-tag">def create_package_from_sources(binary_path, pkg_path, resources):
   try:
       shutil.copytree(os.path.join(resources, 'Resources'),
                       os.path.join(os.path.split(binary_path)[0],
                       'Resources'))
   except:
       pass
   command = 'pkgbuild --root %s/ %s --scripts %s/scripts ' \
              % (os.path.split(binary)[0], pkg_path, resources)
   command += '--identifier biicode --version %s ' % version
   command += '--install-location usr/lib/biicode'
   print command
   return os.system(command)</pre><p>So we copy the previously mentioned files (resources) to a Resources file in the pyinstaller generated folder and invoke pkgbuild.</p><p>pkgbuild builds an OS X Installer component package from on-disk files. A “component package” contains payload to be installed by the OS X Installer. Although a component<br
/> package can be installed on its own, it is typically incorporated into a product archive, along with a “distribution” and localized resources, using<a
href="https://developer.apple.com/library/mac/documentation/Darwin/Reference/ManPages/man1/productbuild.1.html#//apple_ref/doc/man/1/productbuild"> productbuild.</a></p><p>So then we can create the final product package:</p><pre class="crayon-plain-tag">def create_product_package(holder, resources):
   dist_file = os.path.join(holder, 'Distribution.xml')
   shutil.copy(os.path.join(resources, 'Distribution.xml'), dist_file)
   file_utils.search_and_replace(dist_file, '%VERSION%', version)
   file_utils.search_and_replace(dist_file, '%PKG%', 'tmpbiicode.pkg')
   command = 'productbuild '
   command += '--distribution %s ' % dist_file
   command += '--package-path %s ' % holder
   command += '--resources %s ' % os.path.join(resources, 'Resources')
   command += '~/biicode.pkg'
   print command
   print holder
   return os.system(command)</pre><p>productbuild builds a product archive for the OS X Installer or the Mac App Store. A product archive is a flat file with a .pkg extension.  productbuild creates a deployable product archive, which can be used with the OS X Installer, or submitted to the Mac App Store.</p><p>An additional step would be signing the package so it comes from a “trusted” developer (and you dont need to right-click on it to install it) but we are skipping that step for the moment.</p><p>Hope you enjoy packaging!<br
/></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-automating-macos-pkg-generation/">bii internals: Automating MacOS pkg generation</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/bii-internals-automating-macos-pkg-generation/feed/</wfw:commentRss> <slash:comments>2</slash:comments> </item> <item><title>bii internals: Packaging a compiled app with PyInstaller</title><link>http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/</link> <comments>http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/#comments</comments> <pubDate>Fri, 23 May 2014 17:57:59 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[biicode]]></category> <category><![CDATA[app]]></category> <category><![CDATA[bii-internals]]></category> <category><![CDATA[packaging]]></category> <category><![CDATA[pyinstaller]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=523</guid> <description><![CDATA[<p>In a previous post we talked about how we compiled biicode into c extensions. Today we are going to talk about how we prepare it for execution with PyInstaler. PyInstaller is a program that converts (packages) Python programs into stand-alone executables, under Windows, Linux, Mac OS X, Solaris and AIX. It does so by packaging [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/">bii internals: Packaging a compiled app with PyInstaller</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p><a
href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/">In a previous post</a> we talked about how we compiled biicode into c extensions. Today we are going to talk about how we prepare it for execution with PyInstaler. PyInstaller is a program that converts (packages) Python programs into stand-alone executables, under Windows, Linux, Mac OS X, Solaris and AIX. It does so by packaging together your code with all third party libraries your code is using along with python runtime libraries. Third party libraries are discovered inspecting imports in your code but this is a problem when your code is in binary extension.</p><p><span
id="more-523"></span></p><p>So we have defined the following process to package our app:</p><p>1. First we create an artificial main that will contain all needed imports for the project, we take them by parsing requirements.txt files and put them under &#8220;if False&#8221; to avoid execution overhead, you can also use <a
href="http://www.pyinstaller.org/export/develop/project/doc/Manual.html#listing-hidden-imports">hidden imports</a> for this, whatever you prefer.</p><pre class="crayon-plain-tag">import biicode.client.shell.bii
import biicode.client
if False:
    # Third party imports
biicode.client.shell.bii.main(sys.argv[1:])</pre><p>Sometimes importing a package is not enough and you need to import the specific subpackage.</p><p>This artificial main is put in the binary extensions folder</p><p>2. Then we autogenerate a spec file for the project</p><pre class="crayon-plain-tag">python $PYINSTALLER_PATH/utils/makespec.py $ARTIFICIAL_MAIN_PATH</pre><p>3. Then we add to the spec file folders that are not automatically included: folders with binary data or packages that pyinstaller fail to import correctly</p><pre class="crayon-plain-tag">a.datas += Tree('BII_SRC_PATH/biicode/client/setups/images', prefix = 'images')
dict_tree = Tree('MIMER_PATH', prefix = 'mimer', excludes=["*.pyc"])
          # This package is a gittler non pypip dependency
          # It contains dynamically loadable resources that are not
          # automatically included by pyinstaller
a.datas += dict_tree
a.datas += Tree('CRYPTO_PATH', prefix='Crypto', excludes=["*.pyc"])
a.binaries += Tree('BII_COMPILED_PATH/biicode', prefix='biicode')</pre><p>4. Now we are ready to create the executable with pyinstaller</p><pre class="crayon-plain-tag">python pyinstaller.py -p $BII_COMPILED_PATH $SPEC_FILE</pre><p>This generates a folder with an executable and everything we need to run our app.<br
/></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/">bii internals: Packaging a compiled app with PyInstaller</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/bii-internals-packaging-a-compiled-app-with-pyinstaller/feed/</wfw:commentRss> <slash:comments>3</slash:comments> </item> <item><title>bii internals: Compiling your python application with Cython</title><link>http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/</link> <comments>http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/#comments</comments> <pubDate>Tue, 13 May 2014 14:19:17 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[biicode]]></category> <category><![CDATA[bii-internals]]></category> <category><![CDATA[cython]]></category> <category><![CDATA[obfuscate]]></category> <category><![CDATA[python]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=429</guid> <description><![CDATA[<p>We are starting a series of blog posts about how we package biicode. We are starting from grounds up, we will discuss compilation, packaging and last but not least installers creation. Cython Distributing your python app to clients it’s a common task that can become hard when &#8220;obfuscated code&#8221; come as requirement. Common answers in [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/">bii internals: Compiling your python application with Cython</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p>We are starting a series of blog posts about how we package biicode. We are starting from grounds up, we will discuss compilation, packaging and last but not least installers creation.</p><h2>Cython</h2><p>Distributing your python app to clients it’s a common task that can become hard when &#8220;obfuscated code&#8221; come as requirement. Common answers in forums are on the lines of “Python is not the language you’re looking for” or &#8220;What are you trying to hide?&#8221; which are a way of trying to avoid the problem, not to solve it. This task can be easily achieved with Cython.</p><div
id="attachment_1920" style="width: 450px" class="wp-caption aligncenter"><img
class="wp-image-1920 size-full" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/05/Cython-logo.png" alt="Cython can be used to compile your python app with biicode" width="440" height="196" /><p
class="wp-caption-text">&#8220;<a
href="http://en.wikipedia.org/wiki/File:Cython-logo.svg#mediaviewer/File:Cython-logo.svg">Cython-logo</a>&#8221; by The logo may be obtained from Cython.. Licensed under <a
title="&lt;a href=&quot;//en.wikipedia.org/wiki/Wikipedia:Non-free_use_rationale_guideline&quot; title=&quot;Wikipedia:Non-free use rationale guideline&quot;&gt;Fair use&lt;/a&gt; of copyrighted material in the context of &lt;a href=&quot;//en.wikipedia.org/wiki/Cython&quot; title=&quot;Cython&quot;&gt;Cython&lt;/a&gt;" href="//en.wikipedia.org/wiki/File:Cython-logo.svg">Fair use</a> via <a
href="//en.wikipedia.org/wiki/">Wikipedia</a>.</p></div><p><span
id="more-429"></span></p><p>Cython is a static compiler for both Python and their own extended Cython programming language that allows us creating C extensions for Python. I generates C code taking your source python code as input and then compiles it into python extensions with all major C/C++ compilers. We are using clang, gcc and MS Visual 9.0 for our different clients.</p><p>Compiling your app with cython is an easy task, you just need to know what do you want to include and what do you want to exclude from your build.</p><p>In biicode, for example, we just compile code under biicode.client and biicode.common modules, we want to exclude tests and also we want to keep __init__.py files as python files because we later package the app with PyInstaller. We need to define following variables:</p><pre class="crayon-plain-tag">biicode_pkg_path = PATH_TO_BIICODE_MODULE
biicode_python_path = os.path.dirname(biicode_pkg_path)
build_dir = FOLDER_OF_YOUR_CHOICE
src_dir = os.path.abspath(os.path.join(build_dir, 'src'))
if not os.path.exists(src_dir):
   os.makedirs(src_dir)
ignored_files = ['__init__.py']
included_dirs = [os.path.join(biicode_pkg_path, dir_) for dir_ in ['client', 'common']]</pre><p>Then you can traverse your source tree, for every file cython will analyze it’s dependencies tree and recompile only if needed.</p><pre class="crayon-plain-tag">from Cython.Build import cythonize
def bii_cythonize(force_compile):
   '''
   Creates c files from your source python
   Params:
       force_compile: boolean, if true compiles regardeless
                      of whether the file has changed or not
   Returns:
       list of c files relative to biicode_pkg_path
   '''
   c_files = []
   for dir_ in included_dirs:
       for dirname, dirnames, filenames in os.walk(dir_):
           if 'test' in dirnames:
               dirnames.remove('test')
           for filename in filenames:
               file_ = os.path.join(dirname, filename)
               stripped_name = os.path.relpath(file_, biicode_python_path)
               file_name, extension = os.path.splitext(stripped_name)
               if extension == '.py':
                   target_file = os.path.join(src_dir, file_name + '.c')
                   if filename not in ignored_files:
                       c_files.append(stripped_name.replace('.py', '.c'))
                       file_dir = os.path.dirname(target_file)
                       if not os.path.exists(file_dir):
                           os.makedirs(file_dir)
                       extension = cythonize(stripped_name,
                                             force=force_compile,
                                             build_dir=src_dir)
   return c_files</pre><p>After this function executes you will have a source tree equivalent to your python one but in C inside your build_dir/src. Then c files that do not longer match to an existing py file need to be deleted (that’s an easy one to automate as you have the list of c_files). You can avoid that last step if you don’t need incremental builds and you always clean your build dir before recompiling.</p><p>Now that we have the list of c files we want to compile them into python extensions but before we may want to ignore python asserts and remove debug flags:</p><pre class="crayon-plain-tag">from distutils import sysconfig
   modules = []
   for c_file in abs_path_c_files:
       relfile = os.path.relpath(c_file, src_dir)
       filename = os.path.splitext(relfile)[0]
       extName = filename.replace(os.path.sep, ".")
       extension = Extension(extName,
                             sources=[c_file],
                             define_macros=[('PYREX_WITHOUT_ASSERTIONS',
                                             None)]  # ignore asserts in code
                             )
       modules.append(extension)
   if platform.system() != 'Windows':
       cflags = sysconfig.get_config_var('CFLAGS')
       opt = sysconfig.get_config_var('OPT')
       sysconfig._config_vars['CFLAGS'] = cflags.replace(' -g ', ' ')
       sysconfig._config_vars['OPT'] = opt.replace(' -g ', ' ')
   if platform.system() == 'Linux':
       ldshared = sysconfig.get_config_var('LDSHARED')
       sysconfig._config_vars['LDSHARED'] = ldshared.replace(' -g ', ' ')
   elif platform.system() == 'Darwin':
       #-mno-fused-madd is a deprecated flag that now causes a hard error
       # but distuitls still keeps it
       # it was used to disable the generation of the fused multiply/add instruction
       for flag, flags_line in sysconfig._config_vars.iteritems():
           if ' -g' in str(flags_line):
               sysconfig._config_vars[flag] = flags_line.replace(' -g', '')
       for key in ['CONFIG_ARGS', 'LIBTOOL', 'PY_CFLAGS', 'CFLAGS']:
           value = sysconfig.get_config_var(key)
           if value:
               sysconfig._config_vars[key] = value.replace('-mno-fused-madd', '')
               sysconfig._config_vars[key] = value.replace('-DENABLE_DTRACE',  '')</pre><p>Now you are ready to compile your native extensions!</p><pre class="crayon-plain-tag">from distutils.extension import Extension
 from distutils.core import setup
 abs_path_c_files = [os.path.join(src_dir, c) for c in c_files]
 setup(
       name="bii",
       version=VERSION,
       script_name='setup.py',
       script_args=['build_ext'],
       packages=['biicode'],
       ext_modules=modules,
       )</pre><p>Now you have your python extensions in build_dir/lib.ARCHITECTURE If you wish to later package them with PyInstaller you now need to copy all your __init__.py to their correspondant folders in build_dir/src but we will cover it in a future post.<br
/> If you liked this post please comment below. If you want to try biicode just click on the sidebar button and if you have any doubts check our <a
href="http://docs.biicode.com">docs</a>, <a
href="http://forum.biicode.com">forum</a>, <a
href="http://stackoverflow.com/questions/tagged/biicode?sort=newest">Stackoverflow tag</a> and <a
href="https://github.com/biicode">Github repos</a>.<br
/></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/">bii internals: Compiling your python application with Cython</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/bii-internals-compiling-your-python-application-with-cython/feed/</wfw:commentRss> <slash:comments>8</slash:comments> </item> <item><title>Compile for Arduino using any editor</title><link>http://blog.biicode.com/compile-for-arduino-using-any-editor/</link> <comments>http://blog.biicode.com/compile-for-arduino-using-any-editor/#comments</comments> <pubDate>Wed, 07 May 2014 12:15:01 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[try this out]]></category> <category><![CDATA[cmake]]></category> <category><![CDATA[compile]]></category> <category><![CDATA[editor]]></category> <category><![CDATA[ide]]></category> <category><![CDATA[multiplatform]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=243</guid> <description><![CDATA[<p>Arduino IDE is a great tool for starters as it sets introduction to programming friction to a minimum. However, as soon as you want to develop more complex projects you discover it’s not enough. Sure you can edit your code with any editor, but you still need to respect Arduino IDE code structure (which is [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/compile-for-arduino-using-any-editor/">Compile for Arduino using any editor</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p><a
title="Arduino IDE" href="http://arduino.cc/en/main/software" target="_blank">Arduino IDE</a> is a great tool for starters as it sets introduction to programming friction to a minimum. However, as soon as you want to develop more complex projects you discover <strong>it’s not enough</strong>. Sure you can edit your code with any editor, but you still need to respect <strong>Arduino IDE code structure</strong> (which is a bit restricting) if you want to be able to compile the code and flash it to your board.</p><p><span
id="more-243"></span></p><p>We think you should be able to use any editor of your choice, be it a simple one as <a
title="Notepad++ free code editor" href="http://notepad-plus-plus.org/" target="_blank">Notepad++</a> or a complex IDE as <a
title="Eclipse IDE" href="http://www.eclipse.org/ide/" target="_blank">Eclipse</a>, and you should also be able to organize your code in different folders and files.</p><p>There are a few alternate IDEs out there and some plugins for existing ones. All of them have the added complexity of having to learn a new program. Also, all of them still require you to download and install the libraries you want to use and none of them allows a simple way of sharing your code.</p><p><strong>With biicode you can use any simple plain text editor</strong> and only need to learn two commands to get started: <a
title="bii find command reference" href="http://docs.biicode.com/biicode/reference/commands.html#bii-find-retrieving-dependencies" target="_blank">bii find</a> and <a
title="bii arduino:upload command reference" href="http://docs.biicode.com/arduino/reference/commands.html#bii-arduino-upload-upload-a-firmware-in-arduino" target="_blank">bii arduino:upload</a>. That’s it. Biicode will search any needed libraries on the cloud, compile your code and flash it to your board.</p><p>These are <strong>examples of simple editors</strong> you can use, depending on your platform:</p><ul><li><strong>Windows</strong>: <a
title="Sublime Text 2 code editor" href="http://www.sublimetext.com/2" target="_blank">Sublime Text</a>, <a
title="Notepad++" href="http://notepad-plus-plus.org/" target="_blank">Notepad++</a> (biicode asks you if you want to install it when you run bii setup:cpp)</li><li><strong>Linux</strong>: <a
title="gedit, Gnome text editor" href="https://wiki.gnome.org/Apps/Gedit" target="_blank">gedit</a>, <a
title="Kate, a KDE multi-document editor" href="http://kate-editor.org/" target="_blank">Kate</a>, <a
title="Sublime Text 2 code editor" href="http://www.sublimetext.com/2" target="_blank">Sublime Text</a></li><li><strong>Macos</strong>: <a
title="TextMate, the missing editor" href="http://macromates.com/" target="_blank">TextMate</a>, <a
title="Xcode" href="https://developer.apple.com/xcode/" target="_blank">Xcode</a>, <a
title="Sublime Text 2 code editor" href="http://www.sublimetext.com/2" target="_blank">Sublime Text</a></li></ul><p>Note for advanced users: If you want to know how we set up project compilation you can have a look to our Meta-configuration of C/C++ projects with CMake post that has been published in <a
title="Meta-configuration of C/C++ projects with CMake | The Source" href="http://www.kitware.com/source/home/post/136" target="_blank">Kitware magazine</a>.</p><p>Step up your Arduino coding!</p><p>Try a new editor &amp; <a
title="biicode login" href="https://www.biicode.com/accounts/login" target="_blank">biicode</a>, you&#8217;ll notice the improvements!<br
/></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/compile-for-arduino-using-any-editor/">Compile for Arduino using any editor</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/compile-for-arduino-using-any-editor/feed/</wfw:commentRss> <slash:comments>0</slash:comments> </item> <item><title>State machine: A more advanced example</title><link>http://blog.biicode.com/state-machine-advanced-example/</link> <comments>http://blog.biicode.com/state-machine-advanced-example/#comments</comments> <pubDate>Mon, 31 Mar 2014 11:11:10 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[try this out]]></category> <category><![CDATA[arduino]]></category> <category><![CDATA[example]]></category> <category><![CDATA[machine]]></category> <category><![CDATA[state]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=359</guid> <description><![CDATA[<p>For the Arduino Day we posted a state machine library. Today we are going to make a more elaborated example. in this example we have a button that is used to switch states in the same way than the previous example and a LCD screen. The LCD screen will rotate among various messages when we [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/state-machine-advanced-example/">State machine: A more advanced example</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p>For the <a
title="Arduino day" href="http://day.arduino.cc/" target="_blank">Arduino Day</a> we posted a state machine library. Today we are going to make a more elaborated example.</p><p>in this example we have a button that is used to switch states in the same way than the <a
title="Arduino Day Project Persistent State Machine" href="http://blog.biicode.com/arduino-day-project-persistent-state-machine" target="_blank">previous example</a> and a LCD screen. The LCD screen will rotate among various messages when we press the button.</p><p>Here is the schematic:</p><p><img
class="alignleft wp-image-385" title="LCD Button State Machine" src="http://blog.biicode.com/wp-content/uploads/sites/2/2014/03/lcd-button-statemachine.png" alt="LCD Button State Machine" width="630" height="474" /></p><p><span
id="more-359"></span></p><p>We are also making a more advanced use of transition functions to control state entry setUp:</p><div><pre class="crayon-plain-tag">#include "Arduino.h"
#include "hithwen/statemachine/eepromstatemachine.h"
#include "hithwen/button/button.h"
#include "hithwen/led/led.h"
#include &lt;LiquidCrystal.h&gt;
StateMachine machine(3, 3);
// initialize the library with the numbers of the interface pins
LiquidCrystal lcd(12, 11, 5, 4, 3, 2);
LED led = LED(13);                 //initialize the lcd LED
void hello() {
    lcd.setCursor(0, 0);
    lcd.print("hello, world!");
}
void off() {
    lcd.noDisplay();
    led.off();
}
void counting() {
    lcd.setCursor(0, 1);
    // print the number of seconds since reset:
    lcd.print(millis()/1000);
}
Button button = Button(8,PULLUP); //initialize the button (wire between pin 12 and ground)
bool button_pressed() {
    bool pressed = button.uniquePress();
    if (pressed) {
        lcd.clear();
    }
    return pressed;
}
bool one2two() {
    bool pressed = button_pressed();
    if (pressed) {
        lcd.display();
        led.on();
        lcd.print("Counting!");
    }
    return pressed;
}
void setup() {
	Serial.begin(9600);
    lcd.begin(16, 2);
    led.on();
	machine.add_transition(0, 1, &amp;button_pressed);
	machine.add_transition(1, 2, &amp;one2two);
	machine.add_transition(2, 0, &amp;button_pressed);
    machine.add_state_function(0, &amp;hello);
    machine.add_state_function(1, &amp;off);
    machine.add_state_function(2, &amp;counting);
}
void loop() {
    int oldstate = machine.current_state();
    int nustate = machine.loop();
}</pre></div><p>And here there is a video of the whole thing working:</p><p><iframe
width="630" height="354" src="https://www.youtube.com/embed/5iwqU--omB4?feature=oembed" frameborder="0" allowfullscreen></iframe></p><p>&nbsp;</p><p
dir="ltr">Wanna try it? just copy the code and do:</p><p></p><pre class="crayon-plain-tag">$ bii find
$ bii arduino:upload</pre><p>Or dont even copy the code</p><pre class="crayon-plain-tag">$ bii open hithwen/statemachine
$ bii arduino:upload</pre><p></p><p
dir="ltr">Happy coding!</p><p></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/state-machine-advanced-example/">State machine: A more advanced example</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/state-machine-advanced-example/feed/</wfw:commentRss> <slash:comments>0</slash:comments> </item> <item><title>Arduino day project: Persistent state machine</title><link>http://blog.biicode.com/arduino-day-project-persistent-state-machine/</link> <comments>http://blog.biicode.com/arduino-day-project-persistent-state-machine/#comments</comments> <pubDate>Sat, 29 Mar 2014 08:07:19 +0000</pubDate> <dc:creator><![CDATA[julia]]></dc:creator> <category><![CDATA[try this out]]></category> <category><![CDATA[arduino]]></category> <category><![CDATA[example]]></category> <category><![CDATA[machine]]></category> <category><![CDATA[state]]></category> <guid
isPermaLink="false">http://blog.biicode.com/?p=357</guid> <description><![CDATA[<p>For the Arduino Day I’ve built a state machine library or deterministic automaton. A state machine serves as a manager that organizes a set of states, or behaviors. It manages the transition between states, and the state itself. There was already a state machine library in arduino playground but there a couple things I didn’t [&#8230;]</p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/arduino-day-project-persistent-state-machine/">Arduino day project: Persistent state machine</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></description> <content:encoded><![CDATA[<p
dir="ltr">For the Arduino Day I’ve built a state machine library or <a
title="Deterministic Automaton Wikipedia" href="http://en.wikipedia.org/wiki/Deterministic_automaton" target="_blank">deterministic automaton</a>. A state machine serves as a manager that organizes a set of states, or behaviors. It manages the transition between states, and the state itself.</p><p
dir="ltr">There was already a<a
title="State Machine Library Playground Arduino" href="http://playground.arduino.cc/code/FiniteStateMachine" target="_blank"> state machine library in arduino playground</a> but there a couple things I didn’t like about it:</p><p
dir="ltr"><span
id="more-357"></span></p><ul><li><p
dir="ltr">It’s not self controlled, you need to have the transition logic inside your loop or interruptions. I like my state machine to be automanaged: Define it once and forget about it.</p></li><li><p
dir="ltr">You may end up needing to define a lot of functions, enter function and exit function can be glued together in what I called transition functions.</p></li><li><p
dir="ltr">It’s not persistent, I’d like my arduino to remain in the same state when I turn it on/off</p></li></ul><p
dir="ltr">So I built a library with following characteristics:</p><ul><li><p
dir="ltr">The machine is initialized with the number of states and number of transitions it needs.</p></li><li><p
dir="ltr">You can optionally define a state function for each state, that will be called before checking state changes.</p></li><li><p
dir="ltr">Then you need to specify each transition. A transition has an origin, a destiny and a transition function. Transition functions do not receive parameters so they must obtain their required info from global variables, input sources etc. If a transition function returns true then the state is changed to destiny.</p></li><li><p
dir="ltr">You can instantiate it as state persistent or not (StateMachine or EEPROMStateMachine)</p></li></ul><p
dir="ltr">So let’s make the same Led example with <a
title="Hithwen StateMachine biicode" href="https://www.biicode.com/hithwen/blocks/hithwen/statemachine/branches/master#.UzWGx615MTY" target="_blank">my state machine</a>:</p><div><pre class="crayon-plain-tag">#include "Arduino.h"
#include "hithwen/statemachine/statemachine.h"
#include "hithwen/button/button.h"
#include "hithwen/led/led.h"
StateMachine machine(4, 4);
LED led = LED(13);                 //initialize the LED
void ledOn() { led.on();}
void ledOff() {led.off();}
void ledFadeIn() {led.fadeIn(500);}
void ledFadeOut() { led.fadeOut(500); }
Button button = Button(12,PULLUP); //initialize the button (wire between pin 12 and ground)
bool button_pressed() {
    return button.uniquePress();
}
void setup() {
	machine.add_transition(0, 1, &amp;button_pressed);
	machine.add_transition(1, 2, &amp;button_pressed);
	machine.add_transition(2, 3, &amp;button_pressed);
	machine.add_transition(3, 0, &amp;button_pressed);
    	machine.add_state_function(0, &amp;ledOn);
    	machine.add_state_function(1, &amp;ledOff);
    	machine.add_state_function(2, &amp;ledFadeIn);
    	machine.add_state_function(3, &amp;ledFadeOut);
}
void loop() {
    machine.loop();
}</pre></div><p
dir="ltr">Wanna try it? just copy the code and do:</p><p></p><pre class="crayon-plain-tag">$ bii find
$ bii arduino:upload</pre><p>Or dont even copy the code</p><pre class="crayon-plain-tag">$ bii open hithwen/statemachine
$ bii arduino:upload</pre><p></p><p
dir="ltr">Happy coding!</p><p></p><div
id="ContainerFriendsSubscribe"><div
class="mc_custom_border_hdr">Stay tuned</div><style>.widget_mailchimpsf_widget .widget-title {
		line-height: 1.4em;
		margin-bottom: 0.75em;
	}
	#mc_subheader {
		line-height: 1.25em;
		margin-bottom: 18px;
	}
	.mc_merge_var {
		margin-bottom: 1.0em;
	}
	.mc_var_label,
	.mc_interest_label {
		display: block;
		margin-bottom: 0.5em;
	}
	.mc_input {
		-moz-box-sizing: border-box;
		-webkit-box-sizing: border-box;
		box-sizing: border-box;
		width: 100%;
	}
	.mc_input.mc_phone {
		width: auto;
	}
	select.mc_select {
		margin-top: 0.5em;
		width: 100%;
	}
	.mc_address_label {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
		display: block;
	}
	.mc_address_label ~ select {
		width: 100%;
	}
	.mc_list li {
		list-style: none;
		background: none !important;
	}
	.mc_interests_header {
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_interest label,
	.mc_interest input {
		margin-bottom: 0.4em;
	}
	#mc_signup_submit {
		margin-top: 1.5em;
		width: 80%;
	}
	#mc_unsub_link a {
		font-size: 0.75em;
	}
	#mc_unsub_link {
		margin-top: 1.0em;
	}
	.mc_header_address,
	.mc_email_format {
		display: block;
		font-weight: bold;
		margin-top: 1.0em;
		margin-bottom: 0.5em;
	}
	.mc_email_options {
		margin-top: 0.5em;
	}
	.mc_email_type {
		padding-left: 4px;
	}</style><div
id="mc_signup"><form
method="post" action="#mc_signup" id="mc_signup_form"> <input
type="hidden" id="mc_submit_type" name="mc_submit_type" value="html" /> <input
type="hidden" name="mcsf_action" value="mc_submit_signup_form" /> <input
type="hidden" id="_mc_submit_signup_form_nonce" name="_mc_submit_signup_form_nonce" value="528a10d57f" /><div
class="mc_form_inside"><div
class="updated" id="mc_message"></div><div
class="mc_merge_var"> <label
for="mc_mv_EMAIL" class="mc_var_label mc_header mc_header_email">Email Address</label> <input
type="text" size="18" placeholder="" name="mc_mv_EMAIL" id="mc_mv_EMAIL" class="mc_input"/></div><div
class="mc_signup_submit"> <input
type="submit" name="mc_signup_submit" id="mc_signup_submit" value="Send" class="button" /></div></div></form></div></div><p></p><p>The post <a
rel="nofollow" href="http://blog.biicode.com/arduino-day-project-persistent-state-machine/">Arduino day project: Persistent state machine</a> appeared first on <a
rel="nofollow" href="http://blog.biicode.com">biicode Blog</a>.</p> ]]></content:encoded> <wfw:commentRss>http://blog.biicode.com/arduino-day-project-persistent-state-machine/feed/</wfw:commentRss> <slash:comments>1</slash:comments> </item> </channel> </rss>